<div class="page welcome-screen">
	<div class="page-content">
		<div class="container welcome-inner">
			<div class="text-align-center mb-4">
				<div class="main-logo center mb-4">
					<div class="logo-icon">
							<center>
						<path d="M71.9842 92.0001H4.06284C2.07803 92.0001 0.469116 90.3912 0.469116 88.4064C0.469116 86.4216 2.07803 84.8127 4.06284 84.8127H71.9842C73.969 84.8127 75.5779 86.4216 75.5779 88.4064C75.5779 90.3912 73.969 92.0001 71.9842 92.0001Z" fill="#F7DBB3"/>
						<path d="M59.4307 66.0549L60.0778 63.5839C60.088 63.5451 60.1146 63.5249 60.1238 63.5235C62.1241 63.1986 67.2742 62.1033 71.8868 58.9584C76.8878 55.5487 79.5311 50.8698 79.5311 45.4275C79.5311 42.6219 78.5693 39.9979 76.8233 38.039C75.502 36.5573 73.2306 36.4268 71.7493 37.7477C70.2678 39.0684 70.1373 41.34 71.458 42.8217C72.1901 43.6428 72.3439 44.692 72.3439 45.4275C72.3439 48.4692 70.8701 50.9528 67.8383 53.0199C64.3207 55.4182 60.1622 56.2356 58.9716 56.4291C56.1484 56.8875 53.8535 58.9814 53.125 61.7635L52.4688 64.2703C52.462 64.296 52.4557 64.3217 52.4496 64.3475C51.5952 67.9335 48.4239 70.438 44.7373 70.438H31.3767C27.6901 70.438 24.5188 67.9335 23.6644 64.3475L16.9215 36.0524C16.6651 34.976 16.9113 33.8605 17.5971 32.9921C18.2828 32.1237 19.311 31.6258 20.4175 31.6258H55.809C56.9155 31.6258 57.9437 32.1239 58.6293 32.9921C59.315 33.8605 59.5614 34.976 59.305 36.0524L56.8332 46.4255C56.373 48.3562 57.5652 50.2943 59.496 50.7543C61.4267 51.2148 63.365 50.0222 63.8248 48.0915L66.2965 37.7184C67.066 34.4891 66.3273 31.143 64.2701 28.5377C62.2126 25.9324 59.1287 24.4384 55.809 24.4384H20.4175C17.0978 24.4384 14.0138 25.9324 11.9564 28.5377C9.89919 31.143 9.16032 34.4893 9.92991 37.7184L16.6721 66.0134C18.301 72.8505 24.3476 77.6254 31.376 77.6254H44.7365C51.7511 77.6253 57.7873 72.8699 59.4307 66.0549ZM38.1557 17.2509C37.4341 17.2509 36.7062 17.0344 36.0737 16.5841C34.4572 15.4325 34.0801 13.1886 35.2315 11.5719C35.3275 11.4372 35.3936 11.3303 35.4385 11.2501C35.3598 11.1064 35.252 10.9256 35.1643 10.7788C34.2871 9.31004 32.4618 6.25394 35.0498 1.79144C36.0457 0.0743568 38.2447 -0.510162 39.9616 0.485658C41.6785 1.48148 42.2632 3.68048 41.2673 5.39738C40.9092 6.01496 40.8983 6.27874 40.8983 6.28125C40.9243 6.4056 41.1714 6.81941 41.3349 7.09325C42.21 8.55841 44.0309 11.6071 41.0857 15.7417C40.3849 16.726 39.2784 17.2509 38.1557 17.2509ZM26.711 15.7419C29.6562 11.6071 27.8353 8.55842 26.9602 7.09343C26.7967 6.81977 26.5496 6.40596 26.5236 6.28143C26.5236 6.27892 26.5345 6.01514 26.8926 5.39756C27.8885 3.68066 27.3038 1.48166 25.5869 0.485838C23.87 -0.509982 21.671 0.0745366 20.6751 1.79162C18.0871 6.25412 19.9124 9.31022 20.7896 10.779C20.8773 10.9258 20.9853 11.1064 21.0638 11.2503C21.0189 11.3304 20.9528 11.4373 20.8568 11.5721C19.7054 13.1887 20.0824 15.4327 21.699 16.5843C22.3315 17.0347 23.0594 17.2511 23.781 17.2511C24.9035 17.2509 26.01 16.726 26.711 15.7419ZM55.2811 15.7419C58.2263 11.6071 56.4054 8.55842 55.5303 7.09343C55.3668 6.81977 55.1197 6.40596 55.0937 6.28143C55.0937 6.27892 55.1046 6.01514 55.4627 5.39756C56.4586 3.68066 55.8739 1.48166 54.157 0.485838C52.4401 -0.509982 50.2411 0.0745366 49.2452 1.79162C46.6572 6.25412 48.4825 9.31022 49.3597 10.779C49.4474 10.9258 49.5554 11.1064 49.6339 11.2503C49.589 11.3304 49.5229 11.4373 49.4269 11.5721C48.2755 13.1887 48.6525 15.4327 50.2691 16.5843C50.9016 17.0347 51.6295 17.2511 52.3511 17.2511C53.4736 17.2509 54.5801 16.726 55.2811 15.7419Z" fill="#04764e" class="svg-primary"/>
						
						<svg width="90" height="90" viewBox="0 0 90 90" fill="none" xmlns="http://www.w3.org/2000/svg">
							
							<path fill="#F7DBB3" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 4.839582 8.180207 C 2.995833 8.180207 1.5 6.684374 1.5 4.839582 C 1.5 2.995833 2.995833 1.5 4.839582 1.5 C 6.684374 1.5 8.180207 2.995833 8.180207 4.839582 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#F7DBB3" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 8.180207 19.160413 C 8.180207 21.005204 6.684374 22.499996 4.839582 22.499996 C 2.995833 22.499996 1.5 21.005204 1.5 19.160413 C 1.5 17.315622 2.995833 15.82083 4.839582 15.82083 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#F7DBB3" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 15.82083 4.839582 C 15.82083 2.995833 17.315622 1.5 19.160413 1.5 C 21.005204 1.5 22.499996 2.995833 22.499996 4.839582 C 22.499996 6.684374 21.005204 8.180207 19.160413 8.180207 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#F7DBB3" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 19.160413 15.82083 C 21.005204 15.82083 22.499996 17.315622 22.499996 19.160413 C 22.499996 21.005204 21.005204 22.499996 19.160413 22.499996 C 17.315622 22.499996 15.82083 21.005204 15.82083 19.160413 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#04764e" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 19.640621 19.640621 L 14.859372 14.859372 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#04764e" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 9.140623 9.140623 L 4.359374 4.359374 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#04764e" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 9.140623 14.859372 L 4.359374 19.640621 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#04764e" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 19.640621 4.359374 L 14.859372 9.140623 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
							<path fill="#04764e" style="stroke-width:1.91;stroke-linecap:butt;stroke-linejoin:miter;stroke:rgb(0.784314%,0.784314%,0.784314%);stroke-opacity:1;stroke-miterlimit:10;" d="M 14.859372 9.140623 L 14.859372 14.859372 C 14.859372 16.43958 13.580206 17.72083 11.999998 17.72083 C 10.420831 17.72083 9.140623 16.43958 9.140623 14.859372 L 9.140623 9.140623 C 9.140623 7.561457 10.420831 6.279165 11.999998 6.279165 C 13.580206 6.279165 14.859372 7.561457 14.859372 9.140623 Z M 14.859372 9.140623 " transform="matrix(3.750001,0,0,3.750001,0,0)"/>
						</svg>
							
						<path style="fill:#F7DBB3;" d="M 19.160156 15.820312 C 21.004687 15.820312 22.5 17.315625 22.5 19.160156 C 22.5 21.004687 21.004687 22.5 19.160156 22.5 C 17.315625 22.5 15.820312 21.004687 15.820312 19.160156 " transform="matrix(1.666667,0,0,1.666667,0,0)"/>
						<path style="fill:#04764e;" d="M 19.640625 19.640625 L 14.859375 14.859375 " transform="matrix(1.666667,0,0,1.666667,0,0)"/>
					</center>
					</div>
					<h2 class="logo-name">D.R.one</h2>
					<p class="logo-text">Delivery App</p>
					<div id="hidetag"><h2 class='label pt-8'>
						Sky Delivery
						<br>
						<br>
						Environmentally Safe
					</h2></div></div>
			</div>
			<div class="clearfix pb-4">

				<a id="firstbuttons1" on:click={() => {document.getElementById('firstbuttons1').style.display = 'none'; document.getElementById('hidelogbtn').style.display = 'flex'; document.getElementById('firstbuttons2').style.display = 'none'; document.getElementById('googlebtn').style.display = 'flex'; account_type.set("customer"); currentMenuItem.set("My Order"); user_type = 0; 
				currentMenuItem.subscribe(value => name = value); console.log(name);}} class="button-large button button-social rounded-xl button-fill mb-40"><img src="/assets/img/social/user.png" alt=""> 
					<span>Customer Login</span>
				</a>

				<a id="firstbuttons2"  on:click={() => {document.getElementById('firstbuttons1').style.display = 'none'; document.getElementById('hidelogbtn').style.display = 'flex'; document.getElementById('firstbuttons2').style.display = 'none'; document.getElementById('googlebtn').style.display = 'flex'; account_type.set("owner"); currentMenuItem.set("My Store"); user_type = 1;}} class="button-large button button-social rounded-xl mb-10" style="border:1px solid #007AFF;"><img src="/assets/img/social/inbox-blue.png" alt="">
					<span>Store Owner Login</span>
				</a>

				<a id="googlebtn" style="display:none; align-items: center; justify-content: center;" class="button-large button button-social rounded-xl button-outline google mt-48 mb-40" on:click={google_login}>
					<img src="/assets/img/social/google-mail.png" alt="" style="vertical-align: middle;">
					<span>Login with Google</span>
				</a>
							
				<a id="hidelogbtn" style="display: none; align-items: center; justify-content: center;" on:click={() => {document.getElementById('inputboxes').style.display = 'block'; document.getElementById('googlebtn').style.display = 'none'; document.getElementById('hidelogbtn').style.display = 'none'; document.getElementById('hidetag').style.display = 'none';}} class="button-large button button-social rounded-xl button-fill mb-40">
					<img src="/assets/img/social/inbox.png" alt="">
					<span>Login With Email</span>
				</a>

				<div id="inputboxes" style="display:none;"><center>
					<input type="text" placeholder="Enter Your Email Address..." id="myemailbox" bind:value={email}
					class="text-align-center text-3xl w-[70vw]" style="color:white; background-color:#a79c91;border-radius:10px;"/>
				<br><input type="text" placeholder="Enter Password..." id="mypassbox" bind:value={password}
					class="text-align-center text-3xl w-[60vw]" style="color:white; background-color:#a79c91;border-radius:10px;"/>
				<a class="button-large button button-social rounded-xl button-outline google mt-15 mb-40" on:click={() => login_or_register(email, password)} style="background-color:#007AFF; color:white">
					<img src="/assets/img/svg/logout.svg" alt=""> <span>Submit</span></a><br>

					<!--a class="button-large button button-social rounded-xl button-outline google mt-15 mb-40" on:click={() => register(email, password)} style="background-color:#007AFF; color:white">
						<img src="/assets/img/svg/logout.svg" alt=""> <span>Register</span></a><br-->
						<a style="display:flex; align-items: center; justify-content: center;" class="button-large button button-social rounded-xl button-outline google mt-48 mb-40" on:click={google_login}>
							<img src="/assets/img/social/google-mail.png" alt="" style="vertical-align: middle;">
							<span>Or Google Login</span></a>

				</div>
			</div>
		</div>
	</div>
</div>

<script>
	import { account } from '../js/appwrite';
	import { writable } from 'svelte/store';
	import { ID } from 'appwrite';
	import { f7 } from 'framework7-svelte';


	import { user_name, user_email, account_type, currentMenuItem } from "../js/store";

	import { 
		APPWRITE_USRE_LIST_COLLECTION_ID,
   	} from "../js/constants.js";
	import { user_regist, get_user } from "../js/profile";

	export let f7router;

	let user_type;

	let store = writable(null);

	let name = '';
	let email = '';
	let password = '';

	const init = () => {
		try {
			store.set(account.get());
		} catch (e) {
			store.set(null);   }   }


	const login = async (email, password) => {
		const promise = await account.createEmailSession(email, password);
		await init();
		user_email.set(email);
		user_name.set(email.split('@')[0]);
		const user_data = await get_user(APPWRITE_USRE_LIST_COLLECTION_ID, promise.$id);
		if(user_data != null){
			if(user_data['documents'][0].user_type == 0){
				window.location.href = "/home/";    
			}else if(user_data['documents'][0].user_type == 1){
				window.location.href = "/home-store/";    
			}
		} 
	}


	const register = async (email, password) => {
		const uname = email.split('@')[0];
		const promise = await account.create(ID.unique(), email, password, uname);
		if(promise.$id != null){
			if(user_type != null){
				const data = {
					user_id: promise.$id,
					user_type: user_type,
				};
				try {
					await user_regist(APPWRITE_USRE_LIST_COLLECTION_ID, data);
				} catch (exception) {	
					console.error(": ", exception);
				}
			}
		}
		await login(email, password)   
	}


	const login_or_register = async (email, password) => {
		try {
			await login(email, password);
		} catch (error) {
			console.log('error');
			await register(email, password);   }  }


	const google_login = async () => {
		try {
			const baseUrl = window.location.origin;
			// const response = account.createOAuth2Session('google');
			const response = account.createOAuth2Session('google', `${baseUrl + '/#!/home/'}`, `${baseUrl + '/#!/welcome/'}`);
		} catch (err) {
			console.error('Google login error: ', err);    }    }


	const facebook_login = async () => {
		try {
			const baseUrl = window.location.origin;
			const response = account.createOAuth2Session('facebook', `${baseUrl + '/#!/home/'}`, `${baseUrl + '/#!/welcome/'}`);
		} catch (err) {
			console.error('Facebook login error: ', err);   }    }

</script>

<style>
    #myemailbox::placeholder {	color: white;	}
    #mypassbox::placeholder {	color: white;	}

	
	.item-content::before,
	.item-content::after {
		content: none !important;	}

</style>